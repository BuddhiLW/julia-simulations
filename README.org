#+title: Notes
#+LATEX_HEADER: \usepackage{amsmath}
#+LATEX: \newcommand{\binomial}[2]{\genfrac{(}{)}{0pt}{}{#1}{#2}}

#+begin_src emacs-lisp
(setq org-format-latex-options (plist-put org-format-latex-options :scale 3.0))


* Kelly Criterion
** Bias coin-toss
Let $X_i$ be the bankroll, in the moment of the =i-th= coin-toss.

\begin{equation}
\begin{aligned}
X_{n}&=X_{n-1}+\,T_{k}\,B_{k} \\
\Leftrightarrow X_{n}&=X_{0}+\sum_{k=1}^{n}\,T_{k}\,B_{k}
\end{aligned}
\end{equation}

The expectation is:
$E(X_{n})=X_{0}+\sum_{k=1}^{n}E(B_{k}T_{k})=X_{0}+\sum_{k=1}^{n}(p-q)E(B_{k})$

Following this formula, we can simulate these =Random Walks= and even measure, through Monte Carlo Method, the =Probability of Ruin=, given $(p,B_k)$, in which =T= is the outcome - either 1 or -1 (win or lose).

** Using Julia to Simulate the =Random Walk=
#+begin_src julia
using Random, Distributions, Plots

moeda_viciada = Binomial(1, 6/10)
p = plot()
for m=1:10
    v0=400
    n=1000
    jogadas = rand(moeda_viciada, n)
    v=zeros(n)
    v[1]=v0
    for i=1:n-1
        if jogadas[i] == 1
            v[i+1] = v[i] + 1*(0.1*v[i])
        else
            v[i+1] = v[i] - 1*(0.1*v[i])
        end
    end
    plot!(v[1:n], yaxis=:log)
end

for m=1:10
    v0=400
    n=1000
    jogadas = rand(moeda_viciada, n)
    v=zeros(n)
    v[1]=v0
    for i=1:n-1
        if jogadas[i] == 1
            v[i+1] = v[i] + 1*(0.2*v[i])
        else
            v[i+1] = v[i] - 1*(0.2*v[i])
        end
    end
    plot!(v[1:n], yaxis=:log)
end

plot(p, title="VÃ¡rios jogos de 1000 coin-flips", xlabel="EstratÃ©gia, aposta 10% vs 20% (moeda 60% viciada)", ylabel="Valor da banca (escala log)", legend=false)

savefig("estrategia-moeda-viciada.png")
#+end_src

#+ATTR_HTML: :width 1000px
[[file:outputs/estrategia-moeda-viciada.png::‰PNG]]

** Using Julia to Simulate the /expected-value of the growth rate coefficient/

#+begin_src julia
function g(p,q,f)
    return p*log(1+f) + q*log(1-f)
end

fs = range(0,0.5, 100)

function gl(p, q, f)
    return (p-q-f)/((1-f)*(1+f))
end


function gll(p,q,f)
    return (-p/(1+f)^2) + (-q/(1-f)^2)
end

p1=plot(fs,g.(0.6, 0.4,fs), title="Expectativa(aposta)", xlabel="f: aposta", ylabel="g(f): expectativa")
scatter!([0.2],[g(0.6,0.4,0.2)], mc=:red)
annotate!(0.2, 0.021, text("Max", :bottom, 8))
annotate!(0.2, 0.018, text("(x,y) = (0.2, 0.0201)", :top, 8))
p2=plot(fs, gl.(0.6,0.4,fs), title="Derivada primeira")
scatter!([0.2], [0], mc=:red)
annotate!(0.2, 0.02, text("deriv=0", :bottom, 8))
annotate!(0.2, -0.02, text("(x,y) = (0.2, 0.0)", :top, 8))
p3=plot(fs, gll.(0.6,0.4,fs), title="Derivada segunda")
plot(p1,p2,p3)
savefig("expectativa.png")
plot(p2)
#+end_src

#+ATTR_HTML: :width 1000px
[[file:outputs/expectativa.png::‰PNG]]

** Using Julia to Simulate Probability of Ruin
* TODO Monte Carlo
TODO: Comments about integrals with Monte Carlo and the method itself.

#+ATTR_HTML: :width 1000px
[[file:outputs/montecarlo.png::‰PNG]]
* Exercises
Book: Y. A. Rozanov, Probability Theory - A concise course
** Julia functions for solving the execies
*** Binomial, or Combination of =x=, by =y=
#+begin_src julia
function C(x,y)
    return factorial(x)/(factorial(y)*factorial(x-n))
end
#+end_src

#+RESULTS:
: C

** 1.1
#+begin_quote
A four-volume work is placed in random order on a bookshelf. What is the
probability of the volumes being in proper order from left to right or from
right to left?
#+end_quote

*** Answer
The $(b_1, b_2, b_3, b_4)$, 4-tuple is the space we are dealing in.

There are $N=4!$ combinations possible for this space. And, only two that
benefits us, that is, in order of volumes from right to left, and left to right.

Therefore, the probability of these events happening randomly is:

\begin{equation}
\begin{aligned}
P(A) &= \dfrac{N(A)}{N} \\
\Leftrightarrow P(A) &= \dfrac{2}{4!} \\
\Leftrightarrow  P(A) &= \dfrac{1}{12} \\
\therefore P(A) &= 0.0833
\end{aligned}
\end{equation}

#+begin_src julia
import Pkg; Pkg.add("CSV")
import Pkg; Pkg.add("DataFrames")
1/12
#+end_src

#+RESULTS:
: 0.08333333333333333
** 1.2
#+begin_quote
A wooden cube with painted faces is sawed up into 1000 little cubes, all of the
same size. The little cubes are then mixed up, and one is chosen at random
What is the probability of its having just 2 painted faces?

Ans: 0.096
#+end_quote

*** Answer
The space of colored sawed-cubes come all from the border of the former wooden
cube (supposedly). The inner sawed-cubes parts aren't painted.

Then, the cubes that only have two colors, must come from the edges of the cube,
but not from it's vertices - which would have three color-faces.

There are 12 edges; there are 8 vertices; each edge has 10 cubes, of which 8
aren't vertices - because there are 1000 sawed-cubes, of same volume
($\text{cubes} = 10*10*10$) and the two vertices in an edge are a cube of three
colored face.

Thus, the edge cubes that aren't vertices are: $(12 * 8)$.

The total cubes are =1000=.

$\therefore P(A) = 96/1000 \quad \leftrightarrow \quad P(A) = 0.096$
** 1.3
#+begin_quote
A batch of *n* manufactured items contains *k* defective items. Suppose *m*
items are selected at random from the batch. What is the probability that *l* of
these items are defective?
#+end_quote

*** Answer

- *n*: manufactured.
- *k*: defected out of the *n* defected.
- *m*: selection-size.
- *l*: number of selected items, out of the *m* selected, which are defected.

By =theorem 1.3=, given here, without proof (see the book for proof),
#+begin_quote
THEOREM 1.3.
A population of n elements has precisely
\begin{equation}
\begin{aligned}
C_r^n = \dfrac{n!}{r!(n-r)!}
\end{aligned}
\end{equation}
subpopulations of size r < n.
#+end_quote

So, your total number of combinations m-selections is exactly the =binomial
coeficient= $N=C_{m}^{n}$, or $\genfrac{(}{)}{0pt}{}{n}{k}$.

The total of combination of m-selections, in which =l= are defected, follows from:
- =l= of those =m=-selected are defected.
- There are =k= defected in the population.
- $l-m$ of the selected are not defected, and they come from the $n-m$ population of non-defected.

Thus, the number of possible combinations of selecting =l= from =m=, which are
defected can be numbered by: multiplying the combination =l=-selected from =k=
population, and the combination of (=l-m=)-selected from the (=n-m=) population.

$\therefore N(A)=C_{l}^{k} * C_{l-m}^{n-m}$

Finally, the probability of this event happening is:
$P(A)=\dfrac{N(A)}{N} \, \Leftrightarrow \, P(A)=\dfrac{C_{l}^{k} * C_{l-m}^{n-m}}{C_m^n}$

** 1.4
#+begin_quote
Ten books are placed in random order on a bookshelf. Find the probability
of three given books being side by side.

Ans: \dfrac{1}{15}
#+end_quote

*** Answer
**** Theorem of possible placements of books in a shelf (=BLW:1.1=)
Proof by /Induction/.

If we think of, for example, 4 books in total, and we take the first 3 to be our
side-by-side group. They could be the first three, or the last three. That is,
(4-3)+1 possible placements.

If that's true for =n-1= books, and =m= that we want side-by-side, that is:
((n-1)-m)+1. e.i., =n-m= placements, side-by-side, not-regarded of order. Then, if
we have =n+1= books.

Let's say the =n=-ith book in the shelf is not one of our =m= books (and, implicitly
assumed, is in the end of the shelf).

Then, we will have one more slot we can swap the =m= books further, with this new
book. Furthermore, the previous =(n-m)= places are still there. Therefore, we will
have =(n-m)+1= placements. QED.

**** Answer /per-se/
All possible arrangements are given by the factorial: $N=10!$

There are 10-3+1, i.e., 8, places the three books can be put side by side, by [[*Theorem of possible placements of books in a shelf
(=BLW:1.1=)][BLW:1.1]].

For each 7 placements, there can be 3! possible displacements. Furthermore, for
each of the possible combinations of side-by-side tree-books in a displacement,
there are 7! combinations for the rest of the books. That is, $N(A)=8(3!)(7!)$,
by =T1.1=, about the number of possible ordered-pairs.

\begin{equation}
\begin{aligned}
\therefore P(A) &= \dfrac{N(A)}{N} \, \Leftrightarrow  \, P(A) = \dfrac{8(3!)(7!)}{10!}\\
\therefore P(A) &= \dfrac{1}{15}
\end{aligned}
\end{equation}

By Julia calculation:
#+begin_src julia
8*(factorial(3)*factorial(7))/(factorial(10))
#+end_src

#+RESULTS:
: 0.06666666666666667

#+begin_src julia
1/15
#+end_src

#+RESULTS:
: 0.06666666666666667

**** Another shorter solution
The number of possible subpopulations of the books is $C_3^{10}$. Out of these,
we want exactly one of them.

But, this subpopulation can be in (10-3)+1 possible displacements, by BLW:1.1.

$\therefore P(A) = \dfrac{8}{C_3^{10}} \, \Leftrightarrow \, P(A) = \dfrac{8(3!)(7!)}{10!}$

Thus, $P(A)=0.06667$, or $P(A)= \dfrac{1}{15}$.
